{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

{%- liquid
  assign banners_count = 0
  assign has_banners = false
  
  # Contar solo bloques que tienen imágenes
  for block in section.blocks
    if block.settings.image != blank
      assign banners_count = banners_count | plus: 1
    endif
  endfor
  
  if banners_count > 0
    assign has_banners = true
  endif
-%}

{%- if has_banners -%}
  <div class='promo-banners-section section-{{ section.id }}-padding'>
    <div class='page-width'>
      {%- comment -%} Desktop: Grid layout {%- endcomment -%}
      <div class='promo-banners-container promo-banners-container--desktop{% if banners_count == 1 %} promo-banners-container--single{% elsif banners_count == 2 %} promo-banners-container--double{% endif %}'>
        {%- for block in section.blocks -%}
          {%- if block.settings.image != blank -%}
            <div
              class='promo-banner-item promo-banner-item--fade-in'
              {{ block.shopify_attributes }}
            >
              {%- if block.settings.link != blank -%}
                <a href='{{ block.settings.link }}' class='promo-banner-link'>
                  {{
                    block.settings.image
                    | image_url: width: 1200
                    | image_tag:
                      loading: 'lazy',
                      widths: '375, 550, 750, 1100, 1200',
                      sizes: '(min-width: 990px) 50vw, 100vw',
                      alt: block.settings.alt_text | default: block.settings.image.alt
                  }}
                </a>
              {%- else -%}
                {{
                  block.settings.image
                  | image_url: width: 1200
                  | image_tag:
                    loading: 'lazy',
                    widths: '375, 550, 750, 1100, 1200',
                    sizes: '(min-width: 990px) 50vw, 100vw',
                    alt: block.settings.alt_text | default: block.settings.image.alt
                }}
              {%- endif -%}
            </div>
          {%- endif -%}
        {%- endfor -%}
      </div>

      {%- comment -%} Mobile: Carousel con touch {%- endcomment -%}
      <div class='promo-banners-container promo-banners-container--mobile'>
        <div class='promo-banners-carousel' data-carousel='promo-banners-{{ section.id }}'>
          <div class='promo-banners-track'>
            {%- for block in section.blocks -%}
              {%- if block.settings.image != blank -%}
                <div
                  class='promo-banner-slide{% if forloop.first %} promo-banner-slide--active{% endif %}'
                  {{ block.shopify_attributes }}
                >
                  {%- if block.settings.link != blank -%}
                    <a href='{{ block.settings.link }}' class='promo-banner-link'>
                      {{
                        block.settings.image
                        | image_url: width: 750
                        | image_tag:
                          loading: 'lazy',
                          widths: '375, 550, 750',
                          sizes: '100vw',
                          alt: block.settings.alt_text | default: block.settings.image.alt
                      }}
                    </a>
                  {%- else -%}
                    {{
                      block.settings.image
                      | image_url: width: 750
                      | image_tag:
                        loading: 'lazy',
                        widths: '375, 550, 750',
                        sizes: '100vw',
                        alt: block.settings.alt_text | default: block.settings.image.alt
                    }}
                  {%- endif -%}
                </div>
              {%- endif -%}
            {%- endfor -%}
          </div>
        </div>

        {%- comment -%} Indicadores (dots) {%- endcomment -%}
        {%- if banners_count > 1 -%}
          <div class='promo-banners-indicators'>
            {%- for block in section.blocks -%}
              <button
                type='button'
                class='promo-banners-indicator{% if forloop.first %} promo-banners-indicator--active{% endif %}'
                data-slide-index='{{ forloop.index0 }}'
                aria-label='Ir al banner {{ forloop.index }}'
              ></button>
            {%- endfor -%}
          </div>
        {%- endif -%}
      </div>
    </div>
  </div>
{%- endif -%}

{{ 'promo-banners.css' | asset_url | stylesheet_tag }}
<script src='{{ 'promo-banners.js' | asset_url }}' defer='defer'></script>

{% schema %}
{
  "name": "Banners Promocionales",
  "tag": "section",
  "class": "section section-promo-banners",
  "settings": [
    {
      "type": "header",
      "content": "Espaciado"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Espaciado superior",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Espaciado inferior",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "banner",
      "name": "Banner",
      "limit": 2,
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Imagen"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Enlace"
        },
        {
          "type": "text",
          "id": "alt_text",
          "label": "Texto alternativo",
          "info": "Si se deja vacío, se usará el texto alternativo de la imagen"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Banners Promocionales",
      "blocks": [
        {
          "type": "banner"
        },
        {
          "type": "banner"
        }
      ]
    }
  ]
}
{% endschema %}

